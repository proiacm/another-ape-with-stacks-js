{"version":3,"file":"connect-react.umd.development.js","sources":["../src/react/components/connect/context.tsx","../src/react/components/connect/index.tsx","../src/react/hooks/use-connect.ts"],"sourcesContent":["import React, { useReducer, createContext } from 'react';\nimport { AuthOptions, FinishedAuthData } from '@stacks/connect';\nimport { UserSession } from '@stacks/auth';\n\nenum States {\n  UPDATE_AUTH_OPTIONS = 'data/update-auth-options',\n}\n\ntype Action = { type: string; payload?: any };\n\ntype Dispatch = (action: Action) => void;\n\ntype State = {\n  isOpen: boolean;\n  isAuthenticating: boolean;\n  authData?: FinishedAuthData;\n  authOptions: AuthOptions;\n  userSession?: UserSession;\n};\n\nconst initialState: State = {\n  isOpen: false,\n  isAuthenticating: false,\n  authData: undefined,\n  userSession: undefined,\n  authOptions: {\n    redirectTo: '',\n    manifestPath: '',\n    onFinish: () => null,\n    authOrigin: undefined,\n    sendToSignIn: false,\n    appDetails: {\n      name: '',\n      icon: '',\n    },\n  },\n};\n\nconst connectReducer = (state: State, { type, payload }: { type: string; payload?: any }) => {\n  switch (type) {\n    case States.UPDATE_AUTH_OPTIONS: {\n      return {\n        ...state,\n        authOptions: {\n          ...state.authOptions,\n          ...payload,\n        },\n      };\n    }\n\n    default: {\n      throw new Error(`Unhandled action type: ${type}`);\n    }\n  }\n};\n\nconst ConnectContext = createContext<State>(initialState);\n\nconst ConnectDispatchContext = createContext<Dispatch | undefined>(undefined);\n\nconst ConnectProvider = ({\n  authOptions,\n  children,\n}: {\n  authOptions: AuthOptions;\n  children: any;\n}) => {\n  const [state, dispatch] = useReducer(connectReducer, initialState);\n\n  return (\n    <ConnectContext.Provider value={{ ...state, authOptions }}>\n      <ConnectDispatchContext.Provider value={dispatch}>{children}</ConnectDispatchContext.Provider>\n    </ConnectContext.Provider>\n  );\n};\n\nexport {\n  initialState,\n  connectReducer,\n  ConnectContext,\n  ConnectDispatchContext,\n  ConnectProvider,\n  States,\n};\n","import React from 'react';\nimport { ConnectProvider } from './context';\nimport { AuthOptions } from '@stacks/connect';\n\n/**\n * Usage\n *\n *\n * const auth = {\n      manifestPath: '/static/manifest.json',\n      redirectTo: '/',\n      finished: ({userSession}) => {\n        doFinishSignIn();\n      },\n      authOrigin,\n      appDetails: {\n        name: 'Wink',\n        icon: 'url'\n      }\n    }\n *\n * <Connect authOptions={authOptions} />\n */\nconst Connect = ({ authOptions, children }: { authOptions: AuthOptions; children: any }) => {\n  return <ConnectProvider authOptions={authOptions}>{children}</ConnectProvider>;\n};\n\nexport { Connect };\n","import { useContext } from 'react';\nimport {\n  authenticate,\n  AuthOptions,\n  ContractCallOptions,\n  ContractDeployOptions,\n  STXTransferOptions,\n  openContractCall,\n  openContractDeploy,\n  openSTXTransfer,\n  showBlockstackConnect,\n  ContractCallRegularOptions,\n  ContractCallSponsoredOptions,\n  ContractDeployRegularOptions,\n  ContractDeploySponsoredOptions,\n  STXTransferRegularOptions,\n  STXTransferSponsoredOptions,\n  FinishedAuthData,\n  openStructuredDataSignatureRequestPopup,\n  openSignatureRequestPopup,\n} from '@stacks/connect';\nimport { ConnectContext, ConnectDispatchContext, States } from '../components/connect/context';\nimport { SignatureRequestOptions } from '@stacks/connect';\nimport { StructuredDataSignatureRequestOptions } from '@stacks/connect/src/types/structuredDataSignature';\n\nconst useConnectDispatch = () => {\n  const dispatch = useContext(ConnectDispatchContext);\n  if (!dispatch) {\n    throw new Error('This must be used within the ConnectProvider component.');\n  }\n  return dispatch;\n};\n\nexport const useConnect = () => {\n  const { isOpen, isAuthenticating, authData, authOptions, userSession } =\n    useContext(ConnectContext);\n\n  const dispatch = useConnectDispatch();\n\n  const doUpdateAuthOptions = (payload: Partial<AuthOptions>) => {\n    return dispatch({ type: States.UPDATE_AUTH_OPTIONS, payload });\n  };\n\n  /**\n   *\n   * @param signIn Whether the user should be sent to sign in\n   * @param options\n   */\n  const doOpenAuth = (signIn?: boolean, options?: Partial<AuthOptions>) => {\n    if (signIn) {\n      const _options: AuthOptions = {\n        ...authOptions,\n        ...options,\n        onFinish: (payload: FinishedAuthData) => {\n          authOptions.onFinish?.(payload);\n        },\n        sendToSignIn: true,\n      };\n      void authenticate(_options);\n      return;\n    } else {\n      showBlockstackConnect({\n        ...authOptions,\n        sendToSignIn: false,\n      });\n    }\n    authOptions && doUpdateAuthOptions(authOptions);\n  };\n\n  const doAuth = (options: Partial<AuthOptions> = {}) => {\n    void authenticate({\n      ...authOptions,\n      ...options,\n      onFinish: (payload: FinishedAuthData) => {\n        authOptions.onFinish?.(payload);\n      },\n    });\n  };\n\n  function doContractCall(options: ContractCallRegularOptions): Promise<void>;\n  function doContractCall(options: ContractCallSponsoredOptions): Promise<void>;\n  function doContractCall(options: ContractCallOptions): Promise<void>;\n  function doContractCall(options: ContractCallOptions) {\n    return openContractCall({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function doContractDeploy(options: ContractDeployRegularOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeploySponsoredOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeployOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeployOptions) {\n    return openContractDeploy({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function doSTXTransfer(options: STXTransferRegularOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferSponsoredOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferOptions) {\n    return openSTXTransfer({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function sign(options: SignatureRequestOptions) {\n    return openSignatureRequestPopup({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function signStructuredData(options: StructuredDataSignatureRequestOptions) {\n    return openStructuredDataSignatureRequestPopup({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  return {\n    isOpen,\n    isAuthenticating,\n    authData,\n    authOptions,\n    userSession,\n    doOpenAuth,\n    doAuth,\n    authenticate,\n    doContractCall,\n    doContractDeploy,\n    doSTXTransfer,\n    sign,\n    signStructuredData,\n  };\n};\n"],"names":["States","States2","initialState","isOpen","isAuthenticating","authData","userSession","authOptions","redirectTo","manifestPath","onFinish","authOrigin","sendToSignIn","appDetails","name","icon","connectReducer","state","type","payload","UPDATE_AUTH_OPTIONS","Error","ConnectContext","createContext","ConnectDispatchContext","ConnectProvider","children","useReducer","dispatch","Provider","value","Connect","useConnectDispatch","useContext","useConnect","doUpdateAuthOptions","doOpenAuth","signIn","options","_options","authenticate","doAuth","openContractCall","openContractDeploy","openSTXTransfer","openSignatureRequestPopup","openStructuredDataSignatureRequestPopup","doContractCall","doContractDeploy","doSTXTransfer","sign","signStructuredData"],"mappings":"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"}