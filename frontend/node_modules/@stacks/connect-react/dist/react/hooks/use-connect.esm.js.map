{"version":3,"file":"use-connect.esm.js","sources":["../../../src/react/hooks/use-connect.ts"],"sourcesContent":["import { useContext } from 'react';\nimport {\n  authenticate,\n  AuthOptions,\n  ContractCallOptions,\n  ContractDeployOptions,\n  STXTransferOptions,\n  openContractCall,\n  openContractDeploy,\n  openSTXTransfer,\n  showBlockstackConnect,\n  ContractCallRegularOptions,\n  ContractCallSponsoredOptions,\n  ContractDeployRegularOptions,\n  ContractDeploySponsoredOptions,\n  STXTransferRegularOptions,\n  STXTransferSponsoredOptions,\n  FinishedAuthData,\n  openStructuredDataSignatureRequestPopup,\n  openSignatureRequestPopup,\n} from '@stacks/connect';\nimport { ConnectContext, ConnectDispatchContext, States } from '../components/connect/context';\nimport { SignatureRequestOptions } from '@stacks/connect';\nimport { StructuredDataSignatureRequestOptions } from '@stacks/connect/src/types/structuredDataSignature';\n\nconst useConnectDispatch = () => {\n  const dispatch = useContext(ConnectDispatchContext);\n  if (!dispatch) {\n    throw new Error('This must be used within the ConnectProvider component.');\n  }\n  return dispatch;\n};\n\nexport const useConnect = () => {\n  const { isOpen, isAuthenticating, authData, authOptions, userSession } =\n    useContext(ConnectContext);\n\n  const dispatch = useConnectDispatch();\n\n  const doUpdateAuthOptions = (payload: Partial<AuthOptions>) => {\n    return dispatch({ type: States.UPDATE_AUTH_OPTIONS, payload });\n  };\n\n  /**\n   *\n   * @param signIn Whether the user should be sent to sign in\n   * @param options\n   */\n  const doOpenAuth = (signIn?: boolean, options?: Partial<AuthOptions>) => {\n    if (signIn) {\n      const _options: AuthOptions = {\n        ...authOptions,\n        ...options,\n        onFinish: (payload: FinishedAuthData) => {\n          authOptions.onFinish?.(payload);\n        },\n        sendToSignIn: true,\n      };\n      void authenticate(_options);\n      return;\n    } else {\n      showBlockstackConnect({\n        ...authOptions,\n        sendToSignIn: false,\n      });\n    }\n    authOptions && doUpdateAuthOptions(authOptions);\n  };\n\n  const doAuth = (options: Partial<AuthOptions> = {}) => {\n    void authenticate({\n      ...authOptions,\n      ...options,\n      onFinish: (payload: FinishedAuthData) => {\n        authOptions.onFinish?.(payload);\n      },\n    });\n  };\n\n  function doContractCall(options: ContractCallRegularOptions): Promise<void>;\n  function doContractCall(options: ContractCallSponsoredOptions): Promise<void>;\n  function doContractCall(options: ContractCallOptions): Promise<void>;\n  function doContractCall(options: ContractCallOptions) {\n    return openContractCall({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function doContractDeploy(options: ContractDeployRegularOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeploySponsoredOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeployOptions): Promise<void>;\n  function doContractDeploy(options: ContractDeployOptions) {\n    return openContractDeploy({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function doSTXTransfer(options: STXTransferRegularOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferSponsoredOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferOptions): Promise<void>;\n  function doSTXTransfer(options: STXTransferOptions) {\n    return openSTXTransfer({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function sign(options: SignatureRequestOptions) {\n    return openSignatureRequestPopup({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  function signStructuredData(options: StructuredDataSignatureRequestOptions) {\n    return openStructuredDataSignatureRequestPopup({\n      ...options,\n      authOrigin: authOptions.authOrigin,\n      appDetails: authOptions.appDetails,\n    });\n  }\n\n  return {\n    isOpen,\n    isAuthenticating,\n    authData,\n    authOptions,\n    userSession,\n    doOpenAuth,\n    doAuth,\n    authenticate,\n    doContractCall,\n    doContractDeploy,\n    doSTXTransfer,\n    sign,\n    signStructuredData,\n  };\n};\n"],"names":["useConnectDispatch","dispatch","useContext","ConnectDispatchContext","Error","useConnect","ConnectContext","isOpen","isAuthenticating","authData","authOptions","userSession","doUpdateAuthOptions","payload","type","States","UPDATE_AUTH_OPTIONS","doOpenAuth","signIn","options","_options","onFinish","sendToSignIn","authenticate","doAuth","openContractCall","authOrigin","appDetails","openContractDeploy","openSTXTransfer","openSignatureRequestPopup","openStructuredDataSignatureRequestPopup","doContractCall","doContractDeploy","doSTXTransfer","sign","signStructuredData"],"mappings":";;;;;AAyBA,IAAMA,qBAAqB,SAArBA,kBAAqB,GAAM;MACzBC,WAAWC,WAAWC;;MACxB,CAACF,UAAU;UACP,IAAIG,KAAJ,CAAU,yDAAV;;;SAEDH;CALT;;IAQaI,aAAa,SAAbA,UAAa,GAAM;oBAE5BH,WAAWI;MADLC,qBAAAA;MAAQC,+BAAAA;MAAkBC,uBAAAA;MAAUC,0BAAAA;MAAaC,0BAAAA;;MAGnDV,WAAWD;;MAEXY,sBAAsB,SAAtBA,mBAAsB,CAACC,OAAD,EAAmC;WACtDZ,SAAS;AAAEa,MAAAA,MAAMC,OAAOC,mBAAf;AAAoCH,MAAAA,SAAAA;AAApC;;;MAQZI,aAAa,SAAbA,UAAa,CAACC,MAAD,EAAmBC,OAAnB,EAAsD;QACnED,QAAQ;UACJE,wBACDV,aACAS;AACHE,QAAAA,UAAU,kBAACR,OAAD,EAA+B;AAAA;;+CAC3BQ,0GAAWR;;AAEzBS,QAAAA,cAAc;;;WAEXC,aAAaH;;WAEb;yCAEAV;AACHY,QAAAA,cAAc;;;;mBAGHV,oBAAoBF;;;MAG/Bc,SAAS,SAATA,MAAS,CAACL,OAAD,EAAwC;AAAA,QAAvCA,OAAuC;AAAvCA,MAAAA,OAAuC,GAAP,EAAO;AAAA;;SAChDI,0BACAb,aACAS;AACHE,MAAAA,UAAU,kBAACR,OAAD,EAA+B;AAAA;;8CAC3BQ,4GAAWR;;;;;0BAQLM,SAA8B;WAC7CM,8BACFN;AACHO,MAAAA,YAAYhB,YAAYgB;AACxBC,MAAAA,YAAYjB,YAAYiB;;;;4BAOFR,SAAgC;WACjDS,gCACFT;AACHO,MAAAA,YAAYhB,YAAYgB;AACxBC,MAAAA,YAAYjB,YAAYiB;;;;yBAOLR,SAA6B;WAC3CU,6BACFV;AACHO,MAAAA,YAAYhB,YAAYgB;AACxBC,MAAAA,YAAYjB,YAAYiB;;;;gBAIdR,SAAkC;WACvCW,uCACFX;AACHO,MAAAA,YAAYhB,YAAYgB;AACxBC,MAAAA,YAAYjB,YAAYiB;;;;8BAIAR,SAAgD;WACnEY,qDACFZ;AACHO,MAAAA,YAAYhB,YAAYgB;AACxBC,MAAAA,YAAYjB,YAAYiB;;;;SAIrB;AACLpB,IAAAA,QAAAA,MADK;AAELC,IAAAA,kBAAAA,gBAFK;AAGLC,IAAAA,UAAAA,QAHK;AAILC,IAAAA,aAAAA,WAJK;AAKLC,IAAAA,aAAAA,WALK;AAMLM,IAAAA,YAAAA,UANK;AAOLO,IAAAA,QAAAA,MAPK;AAQLD,IAAAA,cAAAA,YARK;AASLS,IAAAA,gBAAAA,cATK;AAULC,IAAAA,kBAAAA,gBAVK;AAWLC,IAAAA,eAAAA,aAXK;AAYLC,IAAAA,MAAAA,IAZK;AAaLC,IAAAA,oBAAAA;AAbK;;;;;"}